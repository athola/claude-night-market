# {{PROJECT_NAME}} Makefile
# Generated by attune plugin

SHELL := /bin/bash
.DEFAULT_GOAL := help
.DELETE_ON_ERROR:

# Configuration
CARGO ?= cargo
CARGO_HOME ?= .cargo
BIN := {{PROJECT_NAME}}
BIN_PATH := target/release/$(BIN)

# Colors
BOLD := \033[1m
GREEN := \033[32m
BLUE := \033[34m
RESET := \033[0m

# Phony targets
.PHONY: help fmt lint check test test-unit test-integration build build-release \
	clean install run status

help: ## Show this help message
	@echo "$(BOLD)$(BIN) - Development Makefile$(RESET)"
	@echo ""
	@echo "$(BLUE)Available commands:$(RESET)"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | \
		sort | \
		awk 'BEGIN {FS = ":.*?## "}; {printf "$(GREEN)%-20s$(RESET) %s\n", $$1, $$2}'

fmt: ## Format code with rustfmt
	@echo "$(BLUE)Formatting code...$(RESET)"
	$(CARGO) fmt --all

lint: ## Run clippy linting
	@echo "$(BLUE)Running clippy...$(RESET)"
	$(CARGO) clippy --workspace --all-targets -- -D warnings

check: ## Run cargo check
	@echo "$(BLUE)Checking code...$(RESET)"
	$(CARGO) check --workspace --all-targets

test: ## Run all tests
	@echo "$(BLUE)Running tests...$(RESET)"
	$(CARGO) test --workspace --all-features

test-unit: ## Run unit tests only
	@echo "$(BLUE)Running unit tests...$(RESET)"
	$(CARGO) test --workspace --lib --all-features

test-integration: ## Run integration tests
	@echo "$(BLUE)Running integration tests...$(RESET)"
	$(CARGO) test --workspace --test '*' --all-features

build: ## Build in debug mode
	@echo "$(BLUE)Building (debug)...$(RESET)"
	$(CARGO) build --workspace --all-features

build-release: ## Build in release mode
	@echo "$(BLUE)Building (release)...$(RESET)"
	$(CARGO) build --workspace --all-features --release
	@echo "$(GREEN)[OK] Binary: $(BIN_PATH)$(RESET)"

clean: ## Clean build artifacts
	@echo "$(BLUE)Cleaning build artifacts...$(RESET)"
	$(CARGO) clean
	@echo "$(GREEN)[OK] Clean complete$(RESET)"

install: ## Install binary to cargo home
	@echo "$(BLUE)Installing $(BIN)...$(RESET)"
	$(CARGO) install --path . --locked
	@echo "$(GREEN)[OK] Installed to $(CARGO_HOME)/bin/$(BIN)$(RESET)"

run: ## Run the application
	@echo "$(BLUE)Running $(BIN)...$(RESET)"
	$(CARGO) run

status: ## Show project status
	@echo "$(BOLD)=== $(BIN) Status ===$(RESET)"
	@version=$$(grep '^version' Cargo.toml | head -1 | cut -d'=' -f2 | tr -d ' "'); \
	echo "Version: $$version"
	@echo "Rust: $$(rustc --version)"
	@echo "Cargo: $$(cargo --version)"
	@echo "Branch: $$(git rev-parse --abbrev-ref HEAD 2>/dev/null || echo 'N/A')"
	@echo "Binary: $(BIN_PATH) $$(test -f $(BIN_PATH) && echo '(exists)' || echo '(not built)')"

# CI target
ci: fmt lint test ## Run CI checks
	@echo "$(GREEN)[OK] All CI checks passed!$(RESET)"

# Development setup
dev-setup: ## Setup development environment
	@echo "$(BLUE)Setting up development environment...$(RESET)"
	rustup component add rustfmt clippy
	@echo "$(GREEN)[OK] Development environment ready!$(RESET)"
